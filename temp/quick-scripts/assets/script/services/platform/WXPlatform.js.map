{"version":3,"sources":["WXPlatform.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../../../assets/script/services/platform","sourcesContent":["import { IPlatform } from \"./IPlatform\";\nimport { wxApi } from \"../../library/wechat/wxApi\";\n\nexport default class WXPlatform implements IPlatform {\n    async getOpenID() {\n        console.log(\"get openId\");\n        try {\n            // let res = await wxApi.login();\n            // console.log(\"login succ\", res.code, res);\n\n            let res = await wxApi.callFunction(\"login\");\n            console.log(\"call login succ\", res);\n            return res.result.openid;\n        } catch (e) {\n            console.log(\"call login fail\", e);\n        }\n    }\n\n    async authorize() {\n        try {\n            await wxApi.authorize(\"scope.userInfo\");\n            console.log('authorize already');\n        } catch (e) {\n            console.log(\"authorize wait\");\n\n            /** 创建登陆按钮 */\n            let x = window.innerWidth / 2 - 250 / 2;\n            let y = window.innerHeight / 1.2;\n            let button = wx.createUserInfoButton({\n                type: \"text\",\n                text: \"微信登陆\",\n                image: \"\",\n                style: {\n                    left: x,\n                    top: y,\n                    width: 250,\n                    height: 43,\n                    lineHeight: 43,\n                    backgroundColor: \"#FC3768\",\n                    color: \"#ffffff\",\n                    textAlign: \"center\",\n                    fontSize: 18,\n                    borderRadius: 4\n                }\n            });\n            /** 用户点击登陆按钮后获取userInfo */\n            await new Promise(resolve => {\n                button.onTap((res) => {\n                    console.log(\"authorize finish:\", res);\n                    if (res.userInfo) {\n                        button.destroy();\n                        resolve();\n                    }\n                });\n            });\n        }\n    }\n\n    async getUserInfo() {\n        let res = await wxApi.getUserInfo(false, \"zh_CN\");\n        return res.userInfo;\n    }\n\n    async shareAppMessage(title: string, imageUrl: string, query: string) {\n        wx.shareAppMessage({\n            title: title,\n            imageUrl: imageUrl,\n            query: query,\n        });\n    }\n\n    async getLaunchOption() {\n        let res = wx.getLaunchOptionsSync();\n        if (res && res.query) {\n            return {\n                query: res.query,\n                scene: res.scene,\n            };\n        }\n    }\n\n    async getLaunchOptionOnShow() {\n        let res = await wxApi.onShow();\n        if (res && res.query) {\n            return {\n                query: res.query,\n                scene: res.scene,\n            };\n        }\n    }\n\n\n    async showLoading(title: string = \"\") {\n        wx.showLoading({\n            title: title,\n            mask: true\n        });\n    }\n\n    async hideLoading() {\n        wx.hideLoading({\n        });\n    }\n\n    async showToast(title: string, duration: any = 1000) {\n        wx.showToast({\n            title: title,\n            icon: 'none',\n            duration: duration,\n        });\n    }\n\n    async hideToast() {\n        wx.hideToast({\n        });\n    }\n}"]}