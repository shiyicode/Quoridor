{"version":3,"sources":["MenuViewMediator.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,0CAAiE;AACjE,gDAA2C;AAE3C,gDAA2C;AAG3C;IAA8C,oCAAgB;IAG1D,0BAAmB,aAAkB;eACjC,kBAAM,gBAAgB,CAAC,IAAI,EAAE,aAAa,CAAC;IAC/C,CAAC;IAEM,oDAAyB,GAAhC;QACI,OAAO;YACH,4BAAgB,CAAC,gBAAgB;YACjC,4BAAgB,CAAC,gBAAgB;YACjC,4BAAgB,CAAC,cAAc;YAC/B,4BAAgB,CAAC,cAAc;YAC/B,4BAAgB,CAAC,iBAAiB;YAClC,4BAAgB,CAAC,qBAAqB;SACzC,CAAC;IACN,CAAC;IAEM,6CAAkB,GAAzB,UAA0B,YAAmC;QACzD,IAAM,IAAI,GAAG,YAAY,CAAC,OAAO,EAAE,CAAC;QACpC,QAAQ,YAAY,CAAC,OAAO,EAAE,EAAE;YAC5B,KAAK,4BAAgB,CAAC,gBAAgB;gBAClC,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,iBAAK,CAAC,IAAI,CAAC,CAAC;gBAClC,MAAM;YACV,KAAK,4BAAgB,CAAC,gBAAgB;gBAClC,MAAM;YACV,KAAK,4BAAgB,CAAC,cAAc;gBAChC,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,iBAAK,CAAC,IAAI,CAAC,CAAC;gBAClC,MAAM;YACV,KAAK,4BAAgB,CAAC,cAAc;gBAChC,MAAM;YACV,KAAK,4BAAgB,CAAC,iBAAiB,CAAC,CAAC;gBACrC,oBAAoB;gBACpB,OAAO,CAAC,GAAG,CAAC,mBAAmB,CAAC,CAAC;gBACjC,EAAE,CAAC,QAAQ,CAAC,SAAS,CAAC,iBAAK,CAAC,IAAI,CAAC,CAAC;gBAClC,MAAM;aACT;YACD,KAAK,4BAAgB,CAAC,qBAAqB,CAAC,CAAC;gBACzC,IAAI,CAAC,mBAAmB,EAAE,CAAC;gBAC3B,MAAM;aACT;YACD,KAAK,4BAAgB,CAAC,iBAAiB,CAAC,CAAC;gBACrC,MAAM;aACT;YACD,KAAK,4BAAgB,CAAC,oBAAoB,CAAC,CAAC;gBACxC,MAAM;aACT;SACJ;IACL,CAAC;IAEM,qCAAU,GAAjB;QACI,IAAM,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,mBAAS,CAAC,IAAI,CAAc,CAAC;QAEzE,IAAI,CAAC,QAAQ,EAAE,CAAC;QAChB,IAAI,CAAC,YAAY,EAAE,CAAC;QAEpB,SAAS,CAAC,UAAU,EAAE,CAAC;IAC3B,CAAC;IAEM,mCAAQ,GAAf;IACA,CAAC;IAEM,uCAAY,GAAnB;QACI,IAAM,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,mBAAS,CAAC,IAAI,CAAc,CAAC;QACzE,IAAM,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,mBAAS,CAAC,IAAI,CAAc,CAAC;QACzE,IAAM,aAAa,GAAG,IAAI,CAAC,aAAyB,CAAC;QAErD,SAAS;QACT,aAAa,CAAC,gBAAgB,GAAG,UAAC,KAAK,EAAE,IAAI;YACzC,OAAO,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC;YAElC,aAAa,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;YAC7B,SAAS,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;QAC7B,CAAC,CAAC;QAEF,aAAa,CAAC,gBAAgB,GAAG,UAAC,KAAK,EAAE,IAAI;YACzC,OAAO,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC;YAElC,aAAa,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;YAC7B,SAAS,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;QAC7B,CAAC,CAAC;QAEF,qCAAqC;QACrC,aAAa,CAAC,gBAAgB,GAAG,UAAC,KAAK,EAAE,IAAI;YACzC,OAAO,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC;YAClC,SAAS,CAAC,UAAU,CAAC,oBAAQ,CAAC,KAAK,CAAC,CAAC;QACzC,CAAC,CAAC;QAEF,aAAa,CAAC,gBAAgB,GAAG,UAAC,KAAK,EAAE,IAAI;YACzC,OAAO,CAAC,GAAG,CAAC,oBAAoB,CAAC,CAAC;YAClC,SAAS,CAAC,UAAU,CAAC,oBAAQ,CAAC,KAAK,CAAC,CAAC;QACzC,CAAC,CAAC;QAEF,aAAa,CAAC,iBAAiB,GAAG,UAAC,KAAK,EAAE,IAAI;YAC1C,OAAO,CAAC,GAAG,CAAC,qBAAqB,CAAC,CAAC;YACnC,6FAA6F;QACjG,CAAC,CAAC;IACN,CAAC;IAEM,mCAAQ,GAAf;QACI,IAAM,aAAa,GAAG,IAAI,CAAC,aAAyB,CAAC;QACrD,IAAM,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,mBAAS,CAAC,IAAI,CAAc,CAAC;QAEzE,aAAa,CAAC,WAAW,CAAC,SAAS,CAAC,WAAW,EAAE,CAAC,CAAC;QAEnD,IAAI,QAAQ,GAAG,SAAS,CAAC,WAAW,EAAE,CAAC;QACvC,aAAa,CAAC,WAAW,CAAC,QAAQ,CAAC,SAAS,EAAE,QAAQ,CAAC,QAAQ,CAAC,CAAC;IACrE,CAAC;IAED,8CAAmB,GAAnB;QACI,IAAM,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,mBAAS,CAAC,IAAI,CAAc,CAAC;QAEzE,IAAI,MAAM,GAAG,SAAS,CAAC,SAAS,EAAE,CAAC;QACnC,SAAS,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC;QAExB,OAAO,CAAC,GAAG,CAAC,mBAAmB,EAAE,MAAM,CAAC,CAAC;QACzC,IAAI,CAAC,MAAM,IAAI,MAAM,CAAC,KAAK,IAAI,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,IAAI,IAAI,IAAI,MAAM,CAAC,KAAK,IAAI,IAAI,CAAC,EAAE;YAC5F,QAAQ,MAAM,CAAC,KAAK,CAAC,IAAgB,EAAE;gBACnC,KAAK,oBAAQ,CAAC,KAAK,CAAC,CAAC;oBACjB,IAAM,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,mBAAS,CAAC,IAAI,CAAc,CAAC;oBACzE,SAAS,CAAC,QAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;oBACxC,MAAM;iBACT;gBACD,OAAO,CAAC,CAAC;iBAER;aACJ;SACJ;IACL,CAAC;IA/Ha,qBAAI,GAAW,kBAAkB,CAAC;IAgIpD,uBAAC;CAjID,AAiIC,CAjI6C,OAAO,CAAC,QAAQ,GAiI7D;kBAjIoB,gBAAgB","file":"","sourceRoot":"../../../../../assets/script/view","sourcesContent":["import { RoomNotification, GameType, Scene } from \"../Constants\";\nimport UserProxy from \"../model/UserProxy\";\nimport MenuView from \"../view/component/MenuView\";\nimport RoomProxy from \"../model/RoomProxy\";\n\n\nexport default class MenuViewMediator extends puremvc.Mediator implements puremvc.IMediator {\n    public static NAME: string = \"MenuViewMediator\";\n\n    public constructor(viewComponent: any) {\n        super(MenuViewMediator.NAME, viewComponent);\n    }\n\n    public listNotificationInterests(): string[] {\n        return [\n            RoomNotification.ROOM_CREATE_SUCC,\n            RoomNotification.ROOM_CREATE_FAIL,\n            RoomNotification.ROOM_JOIN_SUCC,\n            RoomNotification.ROOM_JOIN_FAIL,\n            RoomNotification.ROOM_RETURN_CHECK,\n            RoomNotification.ROOM_RETURN_NOT_CHECK,\n        ];\n    }\n\n    public handleNotification(notification: puremvc.INotification): void {\n        const data = notification.getBody();\n        switch (notification.getName()) {\n            case RoomNotification.ROOM_CREATE_SUCC:\n                cc.director.loadScene(Scene.ROOM);\n                break;\n            case RoomNotification.ROOM_CREATE_FAIL:\n                break;\n            case RoomNotification.ROOM_JOIN_SUCC:\n                cc.director.loadScene(Scene.ROOM);\n                break;\n            case RoomNotification.ROOM_JOIN_FAIL:\n                break;\n            case RoomNotification.ROOM_RETURN_CHECK: {\n                // TODO 对已在房间的玩家弹选择框\n                console.log(\"room return check\");\n                cc.director.loadScene(Scene.ROOM);\n                break;\n            }\n            case RoomNotification.ROOM_RETURN_NOT_CHECK: {\n                this.actionByLaunchQuery();\n                break;\n            }\n            case RoomNotification.ROOM_RETURN_AGREE: {\n                break;\n            }\n            case RoomNotification.ROOM_RETURN_DISAGREE: {\n                break;\n            }\n        }\n    }\n\n    public onRegister(): void {\n        const roomProxy = this.facade.retrieveProxy(RoomProxy.NAME) as RoomProxy;\n\n        this.initView();\n        this.initCallback();\n\n        roomProxy.returnRoom();\n    }\n\n    public onRemove(): void {\n    }\n\n    public initCallback() {\n        const roomProxy = this.facade.retrieveProxy(RoomProxy.NAME) as RoomProxy;\n        const userProxy = this.facade.retrieveProxy(UserProxy.NAME) as UserProxy;\n        const viewComponent = this.viewComponent as MenuView;\n\n        // 设置控件回调\n        viewComponent.mode2ButtonClick = (event, data) => {\n            console.log(\"mode2 button click\");\n\n            viewComponent.setModeType(4);\n            userProxy.setModeType(4);\n        };\n\n        viewComponent.mode4ButtonClick = (event, data) => {\n            console.log(\"mode4 button click\");\n\n            viewComponent.setModeType(2);\n            userProxy.setModeType(2);\n        };\n\n        // TODO 后续多个游戏模式若耦合过多，可以整合为一个callback\n        viewComponent.team2ButtonClick = (event, data) => {\n            console.log(\"team2 button click\");\n            roomProxy.createRoom(GameType.TEAM2);\n        };\n\n        viewComponent.team4ButtonClick = (event, data) => {\n            console.log(\"team4 button click\");\n            roomProxy.createRoom(GameType.TEAM4);\n        };\n\n        viewComponent.match2ButtonClick = (event, data) => {\n            console.log(\"match2 button click\");\n            // this.facade.sendNotification(RoomNotification.ROOM_CREATE, { gameType: GameType.MATCH2 });\n        };\n    }\n\n    public initView() {\n        const viewComponent = this.viewComponent as MenuView;\n        const userProxy = this.facade.retrieveProxy(UserProxy.NAME) as UserProxy;\n\n        viewComponent.setModeType(userProxy.getModeType());\n\n        let userInfo = userProxy.getUserInfo();\n        viewComponent.setUserInfo(userInfo.avatarUrl, userInfo.nickName);\n    }\n\n    actionByLaunchQuery() {\n        const userProxy = this.facade.retrieveProxy(UserProxy.NAME) as UserProxy;\n\n        let launch = userProxy.getLaunch();\n        userProxy.setLaunch({});\n\n        console.log(\"loadByLaunchQuery\", launch);\n        if ((launch && launch.query && launch.scene) && (launch.scene == 1007 || launch.scene == 1008)) {\n            switch (launch.query.type as GameType) {\n                case GameType.TEAM2: {\n                    const roomProxy = this.facade.retrieveProxy(RoomProxy.NAME) as RoomProxy;\n                    roomProxy.joinRoom(launch.query.roomId);\n                    break;\n                }\n                default: {\n\n                }\n            }\n        }\n    }\n}"]}